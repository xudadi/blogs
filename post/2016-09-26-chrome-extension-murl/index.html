<html>

<head lang="zh">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<meta content="telephone=no" name="format-detection" />
<meta name="renderer" content="webkit">
<title>
  mUrl：自动生成 Markdown 格式的链接 | 许大地博客
</title>
<link href="https://xudadi.cn/styles/main.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="https://xudadi.cn/media/scripts/jquery.js"></script>
<script type="text/javascript" src="https://xudadi.cn/media/scripts/basic.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

</head>

<body>
  <div class="header">
  <div class="logo_title">

    <div class="title animated fadeInDown"><a href="/"></a><img
        src="https://xudadi.cn/images/avatar.png?v=1670554342329" /></a>

      <h1 title="许大地博客" class="weaklink"><a href="/">
          许大地博客
        </a>
      </h1>

      <div class="navbar weaklink">
        <div class="normal_nav">

          <div class="bitcron_nav_container">

            <div class="bitcron_nav">
              <div class="mixed_site_nav_wrap site_nav_wrap">

                <ul class="mixed_site_nav site_nav sm sm-base">
                  
                    <li><a id="Nav" href="/" class="selected active current nav_item">
                        首页
                      </a>

                    </li>
                    
                    <li><a id="Nav" href="/archives" class="selected active current nav_item">
                        归档
                      </a>

                    </li>
                    
                    <li><a id="Nav" href="/tags" class="selected active current nav_item">
                        标签
                      </a>

                    </li>
                    
                    <li><a id="Nav" href="/post/about" class="selected active current nav_item">
                        关于
                      </a>

                    </li>
                    

                </ul>

                <div class="clear clear_nav_inline_end"></div>

              </div>

            </div>

            <div class="clear clear_nav_end"></div>

          </div>

        </div>

        <div class="hamberger"><i class="fa fa-bars"></i>
          <i class="fa fa-times"></i>

        </div>

      </div>

    </div>

  </div>

  <div class="hidden_nav animated fadeInDown">

    <div class="bitcron_nav_container">

      <div class="bitcron_nav">
        <div class="mixed_site_nav_wrap site_nav_wrap">
          <ul class="mixed_site_nav site_nav sm sm-base">

            
              <li><a id="Nav" href="/" class="selected active current nav__item">
                  首页
                </a>

              </li>

              
              <li><a id="Nav" href="/archives" class="selected active current nav__item">
                  归档
                </a>

              </li>

              
              <li><a id="Nav" href="/tags" class="selected active current nav__item">
                  标签
                </a>

              </li>

              
              <li><a id="Nav" href="/post/about" class="selected active current nav__item">
                  关于
                </a>

              </li>

              

          </ul>

          <div class="clear clear_nav_inline_end"></div>

        </div>

      </div>

      <div class="clear clear_nav_end"></div>

    </div>

  </div>

</div>

    <div class="main">
      <div class="main-inner">

        <div class="content">

          <div class="post_page">

            <div class="post">
              <div class="post_title sm_margin">
                <h2><a>
                    mUrl：自动生成 Markdown 格式的链接
                  </a>

                </h2>
              </div>

              <div class="post_details">
                <div class="info"><i class="fa fa-clock-o"></i>
                  <span class="date_info">
                    2019-09-19
                  </span>
                  <i class="fa fa-eye"></i>

                  <span class="date_info"><span id="busuanzi_value_page_pv"></span> 查看</span>

                  <i class="fa fa-bookmark-o"></i>
                  <span class="tags_info weaklink">
                    
                      <a href="https://xudadi.cn/tag/VIxS99mWUL/" class="tag">
                        markdown
                      </a>
                      

                  </span>

                </div>

              </div>

              <div class="post_content markdown">
                <p class="md_block">
                  <span class="md_line md_line_start md_line_end">
                    <p>因为懒，花了半个下午时间开发了一个 Chrome 插件，第一次接触这方面东西，写个博客记录下开发过程。</p>
<h3 id="需求来源">需求来源</h3>
<p>写 Markdown 的时候可能都有这样一个需求：</p>
<p>我们需要插入一个文章链接，格式为 Markdown 的格式，例如这样的一个链接：</p>
<p><a href="http://jaeger.itscoder.com/">http://jaeger.itscoder.com</a></p>
<!-- more -->
<p>访问之后，假如我们需要将这个地址直接插入到 Markdown 中，格式如下：</p>
<pre><code class="language-markdown">[写代码的猴子](http://jaeger.itscoder.com)
</code></pre>
<p>在没一个方便的工具之前，我们只能通过两次复制来解决：</p>
<ul>
<li>复制对应的 url：<code>http://jaeger.itscoder.com/</code></li>
<li>复制该 url 对应的标题：写代码的猴子</li>
</ul>
<p>这样的重复性工作对于开发者来说，一点都不酷。因此就催生了 mUrl 插件的诞生。</p>
<h3 id="插件成果">插件成果</h3>
<figure data-type="image" tabindex="1"><img src="/img/postimg/murl_128.png" alt="" loading="lazy"></figure>
<ul>
<li>
<p>源码地址：<a href="https://github.com/laobie/mUrl">laobie/mUrl: a chrome extension: get website url for markdown writer</a></p>
</li>
<li>
<p>Chrome 商店地址：<a href="https://chrome.google.com/webstore/detail/murl/nmhkegedgpbbkcicjgcnbjebdjedljgl?utm_source=chrome-ntp-icon">mUrl - Chrome Web Store</a></p>
</li>
<li>
<p>使用方法：</p>
<ul>
<li>
<p>在 Chrome 应用商店添加插件 mUrl；</p>
</li>
<li>
<p>将 mUrl 放置到地址栏右边，如下所示：</p>
<figure data-type="image" tabindex="2"><img src="/img/postimg/murl_in_chrome.jpg" alt="" loading="lazy"></figure>
</li>
<li>
<p>打开一个网页，然后点这个插件，此时 Markdown 格式的链接就已经复制到剪贴板上了，直接粘贴到 Markdown 文件中即可。</p>
</li>
</ul>
</li>
</ul>
<h3 id="开发过程">开发过程</h3>
<p>这是官方提供的 Chrome 插件的教程：</p>
<p><a href="https://developer.chrome.com/extensions/getstarted">Getting Started: Building a Chrome Extension</a></p>
<p>跟着教程来的话你就可以创建一个你自己的插件，不过官方的例子由于墙的原因，我并没有成功开发出来（伟大的 GFW）。</p>
<p>接下来就以 mUrl 项目为例，讲解下如何开发一个 Chrome 插件。</p>
<ol start="0">
<li>
<p><strong>准备工作</strong></p>
<ul>
<li>一个文本编辑器</li>
<li>Chrome 浏览器</li>
</ul>
</li>
<li>
<p><strong>项目结构</strong></p>
<p>新建一个项目文件夹，我这里创建了一个 <code>mUrl</code> 的文件夹，该文件夹为插件的根目录，里面包含以下文件：</p>
<ul>
<li>
<p><code>manifest.json</code> 项目配置文件，包含一些插件的基本信息</p>
</li>
<li>
<p><code>murl_icon.png</code> 插件图标文件</p>
</li>
<li>
<p><code>popup.html</code> 插件启动时显示的窗体布局</p>
</li>
<li>
<p><code>popup.js</code> 执行相关逻辑的 JavaScript 脚本</p>
</li>
</ul>
<p>接下来就对这些文件的作用和具体开发过程进行讲解。</p>
</li>
<li>
<p><strong>manifest.json</strong></p>
<pre><code class="language-json">{
  &quot;manifest_version&quot;: 2,

  &quot;name&quot;: &quot;mUrl&quot;,
  &quot;description&quot;: &quot;This extension get url for Markdown writer&quot;,
  &quot;version&quot;: &quot;0.1&quot;,

  &quot;browser_action&quot;: {
    &quot;default_icon&quot;: &quot;murl_icon.png&quot;,
    &quot;default_popup&quot;: &quot;popup.html&quot;,
    &quot;default_title&quot;:&quot;Get Url For Markdown writer&quot;
  },
  &quot;icons&quot;: {
    &quot;16&quot;:&quot;asset/murl_16.png&quot;,
    &quot;48&quot;:&quot;asset/murl_48.png&quot;,
    &quot;128&quot;: &quot;asset/murl_128.png&quot;
  },
  &quot;permissions&quot;: [
    &quot;activeTab&quot;
  ]
}
</code></pre>
<p>这是一个 JSON 格式的文件，其中：</p>
<ul>
<li>
<p><code>manifest_version</code>:  一般默认是 2，不用改动</p>
</li>
<li>
<p><code>name</code>: 插件的名称，会显示在 Chrome 商店中</p>
</li>
<li>
<p><code>description</code>: 插件描述</p>
</li>
<li>
<p><code>version</code>: 插件版本号，升级的时候需要更新</p>
</li>
<li>
<p><code>browser_action</code>:  和浏览器相关的</p>
<ul>
<li>
<p><code>default_icon</code>: 显示在地址栏上的图标，19*19 的 png 格式的图片</p>
</li>
<li>
<p><code>default_popup</code>: 一个 HTML 文件，点击插件时弹出来的界面</p>
</li>
<li>
<p><code>default_title</code>: 鼠标移动到图标上显示的提示</p>
</li>
</ul>
</li>
<li>
<p><code>icons</code>: 图标，数字对应图标的大小，这几个尺寸的图标不是必须的，但是为了保证图标显示正常，建议添加这几个尺寸的图标。</p>
</li>
<li>
<p><code>permissions</code>: 插件需要的权限，例如读取网页内容的权限，mUrl 只需要获取到当前 tab 的信息，所以只需要添加一个权限。</p>
</li>
</ul>
</li>
<li>
<p><strong>murl_icon.png</strong></p>
<p>插件的图标文件，在 <code>manifest.json</code> 使用 <code>default_icon</code> 定义的，大小是 19*19，格式为 png 的图片。</p>
</li>
<li>
<p><strong>popup.html</strong></p>
<pre><code class="language-html">&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Copy Url For Markdown&lt;/title&gt;
    &lt;style&gt;
        body {
            font-family: &quot;Segoe UI&quot;, &quot;Lucida Grande&quot;, Tahoma, sans-serif;
            font-size: 100%;
        }
    &lt;/style&gt;
    &lt;script src=&quot;popup.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;clipboard.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;small id=&quot;msg_text&quot;&gt;&lt;/small&gt;
&lt;input id=&quot;md_format_url&quot; value=&quot;test&quot;&gt;
&lt;button class=&quot;btn&quot; id=&quot;btn_copy&quot; data-clipboard-target=&quot;#md_format_url&quot;&gt;copy&lt;/button&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>就是一个简单的 HTML 文件，其中需要指定下需要使用的 <strong>JavaScript</strong> 文件，比如 mUrl 使用了:</p>
<ul>
<li>
<p>popup.js</p>
</li>
<li>
<p>clipboard.js</p>
</li>
</ul>
<p>这两个文件，就通过以下进行了引用：</p>
<pre><code class="language-html">&lt;script src=&quot;popup.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;clipboard.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>这里需要注意的是，在官方给的 <a href="view-source:https://developer.chrome.com/extensions/examples/tutorials/getstarted/popup.html">popup.html</a> 中有这样的一段注释：</p>
<blockquote>
<p>JavaScript and HTML must be in separate files: see our Content Security Policy documentation for details and explanation.</p>
</blockquote>
<p>出于安全性的考虑， JavaScript 文件必须和 HTML 文件分开，而不能为了方便直接在 HTML 文件中执行 JavaScript 脚本。</p>
<p>在 <code>body</code> 中放置了三个元素：</p>
<ul>
<li>
<p><code>small</code>: 用来显示复制结果的信息</p>
</li>
<li>
<p><code>input</code>: 输入框，用来填写 Markdown 格式的链接文本</p>
<p>因为需要复制到剪切板，我使用了一个 <a href="https://github.com/zenorocha/clipboard.js">zenorocha/clipboard.js</a> 这个项目中的 js 代码，需要从一个元素中复制文本，因此只能添加一个输入框，给输入框设置文本内容，然后复制。</p>
</li>
<li>
<p><code>button</code>: 一个按钮，用来复制上面的输入框中的文本，后面使用 JavaScript 自动点击这个按钮，实际上也不需要手动去复制。需要注意到还给 button 添加了一个 <code>data-clipboard-target</code> 属性，这是使用 <code>clipboard.js</code> 需要设置的属性，在点这个按钮的时候，自动取上面提到 input 输入框的内容，复制到剪贴板。</p>
</li>
</ul>
</li>
<li>
<p><strong>popup.js</strong></p>
<p>在讲解 popup.js 内容之前，先说一下开发时遇到的一个问题：</p>
<p>因为需要在点击插件时自动将得到的 Markdown 格式的链接复制到剪贴板上，对于我这个 JavaScript 还没入门的新手来说并不是那么容易，好在通过 Google 搜索了一圈之后，找到了 <a href="https://github.com/zenorocha/clipboard.js">zenorocha/clipboard.js</a>  这项目，解决了这个问题。关于这个项目的具体使用细节可以阅读项目的 README，本文不再赘述。</p>
<pre><code class="language-javascript">function getCurrentTabInfo(callback) {
    var queryInfo = {
        active: true,
        currentWindow: true
    };

    chrome.tabs.query(queryInfo, function (tabs) {
        var tab = tabs[0];
        callback(tab.title, tab.url);
    });
}

document.addEventListener('DOMContentLoaded', function () {
    getCurrentTabInfo(function (title, url) {
        var msgText = document.getElementById(&quot;msg_text&quot;);
        msgText.style.display = &quot;none&quot;;
        var inputText = document.getElementById(&quot;md_format_url&quot;);
        var copyBtn = document.getElementById(&quot;btn_copy&quot;);
        var clipboard = new Clipboard('.btn');
        clipboard.on('success', function (e) {
            console.log(e);
            inputText.style.display = &quot;none&quot;;
            copyBtn.style.display = &quot;none&quot;;
            msgText.textContent = &quot;success&quot;;
            msgText.style.display = &quot;block&quot;;
        });
        clipboard.on('error', function (e) {
            console.log(e);
            alert(e);
        });
      	// 替换标题中的特殊字符，例如“[]()”等
        title = title.replace(/[|\\`*_{}\[\]()#+\-.!]/g, '\\$&amp;');
      	// 拼接 Markdown 格式的链接字符串
        inputText.value = &quot;[&quot; + title + &quot;](&quot; + url + &quot;)&quot;;
        copyBtn.click();
    });
});
</code></pre>
<p>popup.js 的代码应该也不难理解：</p>
<ul>
<li>
<p><code>getCurrentTabInfo()</code> 函数：获取到当期激活的 Tab 的 url 和 title 信息，后面拼接链接需要使用。</p>
</li>
<li>
<p><code>document.addEventListener('DOMContentLoaded', function () {}</code></p>
<p>添加页面加载监听，页面加载时，调用 <code>getCurrentTabInfo()</code> 函数，获得当前 Tab 的标题和 url：</p>
<ul>
<li>
<p>先获取到之前添加的三个元素，并进行显示和隐藏的设置</p>
</li>
<li>
<p>创建一个 Clipboard 对象，用来复制格式化之后的链接</p>
</li>
<li>
<p>设置复制成功和出错的监听，在复制成功时，将 <strong>输入框</strong> 和 <strong>按钮</strong> 隐藏，只显示 『success』文本，复制出错时则弹一个对话框，显示出错信息。</p>
</li>
<li>
<p>在拼接 Markdown 格式的链接字符串之前，先对标题中的特殊字符进行了替换处理，例如 “[”、“]” 需要替换成 “[”、“]” 。</p>
</li>
<li>
<p>自动点击 <strong>复制</strong> 按钮，将文本复制到剪切板，复制成功，就会响应上面设置 <strong>复制成功</strong> 的监听事件。</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>因为项目使用到了 <code>clipboard.js</code> ，所以需要将该 JavaScript 文件也放置到项目文件夹中。</p>
</li>
</ol>
<p>至此，整个项目基本搞定了，接下来就是运行测试了。</p>
<h3 id="运行和发布">运行和发布</h3>
<ol>
<li>
<p>运行</p>
<ul>
<li>
<p>在 Chrome 中打开：<a href="chrome://extensions/">chrome://extensions/</a></p>
</li>
<li>
<p>打开开发者模式，选择项目文件夹，加载插件</p>
<figure data-type="image" tabindex="3"><img src="/img/postimg/open_chrome_extensions.jpg" alt="" loading="lazy"></figure>
</li>
<li>
<p>上一步没报错的话，插件就加载成功了，这是你就可以点击插件图标测试下功能是否正常了。</p>
</li>
<li>
<p>注意到 <strong>加载已解压的扩展程序</strong> 右边有一个 <strong>打包扩展程序</strong> 的按钮，点击这个：</p>
<figure data-type="image" tabindex="4"><img src="/img/postimg/package.jpg" alt="" loading="lazy"></figure>
<p>私有密钥文件第一次可以不选，在第一次打包之后就会自动生成一个 .gem 后缀的私有密钥文件，下次更新插件时需要选择这个密钥文件。</p>
<p>打包会生成一个 .crx 格式的文件，这个就是插件的安装文件，发送给其他人，安装上之后就可以使用该插件了。</p>
</li>
</ul>
</li>
<li>
<p>发布到 Chrome 应用商店</p>
<p>在 <a href="https://chrome.google.com/webstore/developer/dashboard?utm_source=chrome-ntp-icon">Developer Dashboard - Chrome Web Store</a> 按照步骤先注册一个开发者帐号，需要支付 $5 ，如果你没 VISA 信用卡的话，可能就比较麻烦了。</p>
<p>注册好开发者帐号后，<a href="https://chrome.google.com/webstore/developer/update?utm_source=chrome-ntp-icon&amp;publisherId=g03303820154321143420">Upload - Developer Dashboard</a> 在这个页面按照下面的说明，上传项目的源文件，填写上相关的信息，就可以了，页面上说明很齐全，这里不多讲解了。</p>
<p>发布到 Chrome 应用商店之后，别人就可以直接从商店下载安装你开发的插件了。</p>
<p>​</p>
</li>
</ol>
<p>最后，再提一下 mUrl 的插件源码地址：<a href="https://github.com/laobie/mUrl">laobie/mUrl</a>，欢迎提 PR 和建议。</p>
<h3 id="参考资料">参考资料</h3>
<ul>
<li>
<p><a href="http://www.cnblogs.com/guogangj/p/3235703.html">Chrome插件（Extensions）开发攻略 - guogangj - 博客园</a></p>
</li>
<li>
<p><a href="http://9iphp.com/web/javascript/js-copy-library-clipboard-js.html">纯JavaScript实现的复制剪切库–clipboard.js | Specs' Blog-就爱PHP</a></p>
</li>
<li>
<p><a href="https://developer.chrome.com/extensions/getstarted">Getting Started: Building a Chrome Extension - Google Chrome</a></p>
</li>
<li>
<p><a href="https://github.com/ku/CreateLink">ku/CreateLink: Make Link alternative to chrome</a></p>
</li>
</ul>

                </p>

                <p class="md_block">
                <div class="reward">
                  <div class="reward-button">赏 <span class="reward-code"> <span class="alipay-code"> <img
                          class="alipay-img" src="https://xudadi.cn/media/images/alipay.png"><b>支付宝扫码打赏</b>
                      </span> <span class="wechat-code"> <img class="wechat-img"
                          src="https://xudadi.cn/media/images/wechat.png"><b>微信打赏</b> </span> </span></div>
                </div>
                </p>
              </div>

            </div>

            <link href="https://xudadi.cn/styles/main.css" type="text/css" rel="stylesheet" />

            <div class="doc_comments">
              
            </div>

          </div>
        </div>

      </div>

    </div>

    <div class="footer">
  <link href="https://xudadi.cn/styles/main.css" type="text/css" rel="stylesheet" />
  <div class="site_footer_wrap">
    <div class="site_footer">

      <div class="mysocials">
        <div class="my_socials">
          
                
                
                
              <a href="https://github.com/xudadi" target="_blank" title="github"><i
                  class="fa fa-github"></i></a>
              
                
        </div>
        <link href="https://xudadi.cn/styles/main.css" type="text/css" rel="stylesheet" />

      </div>

      <div class="copyright">
        Powered by <a href="https://xudadi.com" target="_blank">xudadi.com</a>
      </div>

    </div>
  </div>

</div>

<style type="text/css">
  a.back_to_top {
    text-decoration: none;
    position: fixed;
    bottom: 40px;
    right: 30px;
    background: #f0f0f0;
    height: 40px;
    width: 40px;
    border-radius: 50%;
    line-height: 36px;
    font-size: 18px;
    text-align: center;
    transition-duration: .5s;
    transition-propety: background-color;
    display: none;
  }

  a.back_to_top span {
    color: #888;
  }

  a.back_to_top:hover {
    cursor: pointer;
    background: #dfdfdf;
  }

  a.back_to_top:hover span {
    color: #555;
  }

  @media print,
  screen and (max-width: 580px) {
    .back_to_top {
      display: none !important;
    }
  }
</style><a id="back_to_top" href="#" class="back_to_top"><span>△</span>
</a>
<script type="text/javascript" src="https://xudadi.cn/media/scripts/jquery.js"></script>

<script>$(document).ready((function (_this) {
    return function () {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function () {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block');
          } else {
            return bt.css('display', 'none');
          }
        });
        return bt.click(function () {
          $('body,html').animate({
            scrollTop: 0
          }, 800);
          return false;
        });
      }
    };
  })(this));
</script>
</body>

</html>